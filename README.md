# dmic-stress-testing

## Name
Dmic-stress-testing

## Description
Simple tool to provide stress test on dmic server.

## Installation
1) Install [dm-marker-generator](https://gitlab.ispras.ru/watermarking/dm-marker-generator)
```
pip install https://gitlab.ispras.ru/watermarking/dm-marker-generator
```
2) Install this package with 
```
pip install git+https://gitlab.ispras.ru/watermarking/dmic-stress-testing.git
```
## Usage
 1) В директории dmic_stress_testing лежит файл config.py, в котором можно задать параметры конфигурации
 2) После установки параметров конфигурации необходимо запустить один из скриптов many_users_work (thread) или async_many_users_work, например, через run в VSCode
 3) Тест начнет работу и в терминале появится значение текущего rps (row per second)
 4) После окончания теста в терминале появятся метрики, соответсвующие запуску

## Project status
Задача перегрузить сервер и сделать это правдоподобно.

Строка на пользователе формируется каждые 10 секунд.
От одного пользователя выгрузка каждые 60 секунд. (По 6 строк, если подключен).
Если нет подключения, то накопленные логи пушатся по максимум 100 штук раз в минуту.
100 строк копятся 1000 секунд. 


МАКСИМАЛЬНАЯ ЗАГРУЗКА - НАИХУДШИЙ СЦЕНАРИЙ
В любом случае, максимальная нагрузка от одного пользователя 100 строк в минуту.

Нужно дойти до 1 млн пользователей.
Значит в самом плохом случае 1 млн пользователей, попав в один временной промежуток, 
будут заваливать сервер 100 млн строк в минуту. 
Для этого у 1 млн пользователей должно накопиться хотя бы по 100 строк у каждого.
100 строк копятся, если нет возможности отправить лог 1000 секунд (почти 17 минут).


МИНИМАЛЬНАЯ ЗАГРУЗКА - НАИЛУЧШИЙ СЦЕНАРИЙ
У 1 млн пользователей постоянно отсылаются логи. Значит по 6 строчек от каждого в минуту.
Получается 6 млн строк в минуту от всех.
А в реальности даже лучше, т.к. нет каких-то общих часов,
по которым спектраторы на всех пользователях одновременно бы отправили свои 6 строк из логов.
